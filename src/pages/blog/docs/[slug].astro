---
import Layout from '../../../layouts/Layout.astro';
import BlogPostViewer from '../../../components/blog/BlogPostViewer';

const { slug } = Astro.params;
const API_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:8749';
const response = await fetch(`${API_URL}/api/posts/${slug}`);
const doc = response.ok ? await response.json() : null;

if (!doc) {
  return Astro.redirect('/blog/docs');
}
---

<Layout title={doc.title}>
  <main class="container mx-auto px-4 py-8 max-w-4xl">
    <article>
      <h1 class="text-4xl font-bold mb-8">{doc.title}</h1>
      <div class="prose dark:prose-invert max-w-none">
        <BlogPostViewer client:load content={doc.content} />
      </div>
    </article>
  </main>
</Layout>