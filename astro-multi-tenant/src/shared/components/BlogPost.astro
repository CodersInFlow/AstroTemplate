---
// Shared blog post component - used by all sites
import { tiptapJsonToHtml } from '../lib/tiptap';

export interface Props {
  slug: string;
  database: string;
  apiUrl?: string;
}

const { slug, database, apiUrl = 'http://127.0.0.1:3001' } = Astro.props;

// Fetch the blog post
const response = await fetch(`${apiUrl}/api/posts/${slug}`, {
  headers: {
    'X-Site-Database': database
  }
});

if (!response.ok) {
  return Astro.redirect('/blog');
}

const post = await response.json();
const htmlContent = tiptapJsonToHtml(post.content);
---

<article class="max-w-4xl mx-auto">
  <header class="mb-8">
    <h1 class="text-4xl font-bold mb-4">{post.title}</h1>
    <div class="flex items-center gap-4 text-gray-400">
      <span>{post.author?.name || 'Admin'}</span>
      <span>â€¢</span>
      <time>{new Date(post.publishedAt || post.createdAt).toLocaleDateString()}</time>
    </div>
  </header>
  
  <div class="prose prose-invert max-w-none" set:html={htmlContent} />
</article>