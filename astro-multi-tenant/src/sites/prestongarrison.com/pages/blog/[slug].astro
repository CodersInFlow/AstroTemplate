---
import PrestonLayout from '../../layouts/PrestonLayout.astro';
import BlogPostPage from '../../../../blog-module/src/pages/BlogPost.astro';

const { slug } = Astro.params;

// Need to fetch just the title for the layout
const API_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:8749';
const response = await fetch(`${API_URL}/api/posts/${slug}`);

if (!response.ok) {
  return Astro.redirect('/404');
}

const post = await response.json();
---

<PrestonLayout title={`${post.title} - Blog`} showHeader={false}>
  <BlogPostPage slug={slug} />
</PrestonLayout>