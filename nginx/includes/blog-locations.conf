# Blog Backend API endpoints
location /api/ {
    # Proxy to blog backend (Go service)
    proxy_pass http://127.0.0.1:8749;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # Important for authentication cookies
    proxy_set_header Cookie $http_cookie;
    proxy_pass_request_headers on;
    
    # Timeout settings
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # Handle request bodies for posts/uploads
    client_max_body_size 10M;
}

# Serve uploaded images from blog
location /uploads/ {
    # Proxy to Go backend which serves the files
    proxy_pass http://127.0.0.1:8749;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # Cache uploaded images
    proxy_cache_valid 200 30d;
    proxy_cache_bypass $http_pragma;
    proxy_cache_revalidate on;
    
    # Add cache headers
    expires 30d;
    add_header Cache-Control "public, immutable";
}

# Blog editor (requires authentication)
location /editor {
    # In production, this will be served from the static build
    try_files $uri $uri/ /index.html;
}

# Blog and docs pages (public)
location ~ ^/(blog|docs)/ {
    # In production, these will be served from the static build
    try_files $uri $uri/ /index.html;
}