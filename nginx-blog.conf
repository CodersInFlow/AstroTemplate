# Add this to your main nginx configuration for the blog functionality

# Proxy API requests to the Go backend
location /api/ {
    proxy_pass http://localhost:8749;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_cache_bypass $http_upgrade;
    
    # Important for cookies/auth
    proxy_set_header Cookie $http_cookie;
    proxy_pass_request_headers on;
}

# Serve uploaded images
location /uploads/ {
    # Option 1: Proxy to Go backend
    proxy_pass http://localhost:8749;
    proxy_cache_valid 200 1d;
    proxy_cache_bypass $http_pragma;
    proxy_cache_revalidate on;
    
    # Option 2: Serve directly from filesystem (faster)
    # alias /path/to/your/uploads/;
    # try_files $uri =404;
}

# Blog and editor routes (if using SSR)
location ~ ^/(blog|docs|editor)/ {
    proxy_pass http://localhost:4321;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
}